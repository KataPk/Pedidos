<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" >

<div id="navbar">
    <div class="navbar-top ">
        <div class="d-inline-flex align-items-center ">
        <div class="bars p-1 col-first" data-bs-target="#staticBackdrop" data-bs-toggle="offcanvas" type="button">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
            <th:block th:if="${clientes} != null ">
        <div class="d-inline-flex col-last position-absolute top-0 start-50 translate-middle-x" id="clientSelect">
            <h1 id="clientLabel" class="col-first me-3">Cliente Atual: </h1>
            <select id="selectClients" class="form-select form-select-lg mb-3 col-last" aria-label="Cliente Atual: " onchange="select()">
                <option th:each="cliente : ${clientes}" th:value="${cliente.id}" th:text="${cliente.nomeCliente}" th:id="'pedido-id-' + ${cliente.id}" >error</option>
            </select>
        </div>
            </th:block>
        </div>

        <div aria-labelledby="staticBackdropLabel" class="offcanvas offcanvas-start" data-bs-backdrop="static" id="staticBackdrop"
             tabindex="-1">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="staticBackdropLabel">Menu</h5>
                <button aria-label="Close" class="btn-close btn-danger" data-bs-dismiss="offcanvas"
                        type="button"></button>



            </div>
            <div class="offcanvas-body">
                <div><a href="/api/user/comandas">Comandas</a>
<!--                    <a href="Categorias">Produtos</a> Checar como irá funcionar por conta do contexto / cliente -->
                    <div sec:authorize="hasRole('ROLE_ADMIN')">
                        <a class="collapsed" data-bs-toggle="collapse" href="#collapseAdm" aria-controls="collapseAdm">Administração</a>
                        <div class="collapse " id="collapseAdm">
                            <a href="/api/admin/funcionarios">Funcionários</a>
                            <a href="/api/admin/mesas">Mesas</a>
                            <a href="/api/admin/produtos">Produtos</a>
                            <a href="/api/admin/categorias">Categorias</a>
                        </div>

                    </div>
                    <a href="/api/user/mesas">Mesas</a>
                    <a aria-controls="collapseExample" aria-expanded="false" class="btn btn-primary" data-bs-target="#logout"
                       data-bs-toggle="modal" id="logoutBtn" role="button">
                        Logout
                    </a>

                </div>
            </div>
        </div>

    </div>
</div>
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="logout" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="labelLogout">Logout</h1>
                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                Tem certeza que deseja fazer Logout?
            </div>
            <div class="modal-footer">
                <form action="/api/logout" method="post">
                <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Fechar</button>
                <button class="btn btn-primary"  type="submit" value="Logout">Fazer logout</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div>
    <button id="Back" onclick="history.back()"><i class='fas'>&#xf053;</i> Voltar
    </button>


</div>
<script>
    document.getElementById('selectClients').addEventListener('change', function () {
        const selectedOption = this.options[this.selectedIndex];
        const selectedPedidoId = selectedOption.getAttribute('th:id');

        if (selectedPedidoId) {

            // Obtém a URL atual
            const currentUrl = window.location.href;

            // Verifica se a URL contém '/api/user/' e captura a parte após '/api/user/' como pedidoId
            const regex = /\/api\/user\/([^/]+)\//;
            const match = currentUrl.match(regex);

            if (match){
                const pedidoId = match[1];

                // Substitui o pedidoId na URL
                // Redireciona para a nova URL
                window.location.href = currentUrl.replace(pedidoId, selectedPedidoId);
            }

        }
    });

</script>
</html>


